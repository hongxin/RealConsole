# 50 个使用场景覆盖分析

**日期**: 2025-10-15
**状态**: 分析中
**目标**: 增强 RealConsole 对 50 个典型使用场景的支持

---

## 执行摘要

### 当前覆盖情况

- **已支持**: 18 个场景 (36%)
- **部分支持**: 5 个场景 (10%)
- **未支持**: 27 个场景 (54%)

### 现有系统能力

**Intent DSL**: 16 个内置意图
- 文件操作：6 个
- 系统监控：10 个

**Tools**: 14 个工具
- 基础工具：5 个
- 高级工具：9 个

---

## 详细场景分析

### 类别 1: 文件管理类 (1-12, 35-42, 49-50) - 26个场景

| # | 场景 | 状态 | 现有支持 | 优先级 |
|---|------|------|----------|--------|
| 1 | 查看当前目录下的文件和子目录 | ✅ 已支持 | list_directory | - |
| 2 | 切换到指定目录路径 | ✅ 已支持 | Shell (cd) | - |
| 3 | 显示当前工作目录的完整路径 | ✅ 已支持 | Shell (pwd) | - |
| 4 | 创建新的目录 | ❌ 未支持 | - | 🔥 高 |
| 5 | 删除文件或目录 | ❌ 未支持 | - | 🔥 高 |
| 6 | 复制文件到指定位置 | ❌ 未支持 | - | 🔥 高 |
| 7 | 移动或重命名文件 | ❌ 未支持 | - | 🔥 高 |
| 8 | 查看文件的内容 | ✅ 已支持 | read_file | - |
| 9 | 编辑文本文件内容 | ✅ 已支持 | write_file | - |
| 10 | 搜索文件中的特定字符串 | ✅ 已支持 | grep_pattern | - |
| 11 | 查找文件按名称或类型 | 🟡 部分支持 | find_large_files, find_recent_files | 🟠 中 |
| 12 | 查看文件权限和属性 | ✅ 已支持 | Shell (ls -l) | - |
| 13 | 修改文件权限 | ❌ 未支持 | - | 🟠 中 |
| 14 | 查看磁盘使用情况 | ✅ 已支持 | check_disk_usage | - |
| 35 | 压缩文件或目录 | ❌ 未支持 | - | 🟠 中 |
| 36 | 解压缩文件 | ❌ 未支持 | - | 🟠 中 |
| 37 | 查看命令历史记录 | ✅ 已支持 | Shell (history) | - |
| 38 | 设置环境变量 | ❌ 未支持 | - | 🟢 低 |
| 39 | 查看环境变量 | 🟡 部分支持 | Shell (env, echo $VAR) | 🟢 低 |
| 40 | 创建符号链接 | ❌ 未支持 | - | 🟢 低 |
| 41 | 比较两个文件的差异 | ❌ 未支持 | - | 🟠 中 |
| 42 | 统计文件行数、字数 | 🟡 部分支持 | count_python_lines | 🟠 中 |
| 43 | 实时监控文件变化 | ❌ 未支持 | - | 🟢 低 |
| 49 | 备份重要文件 | ❌ 未支持 | - | 🟠 中 |
| 50 | 恢复备份数据 | ❌ 未支持 | - | 🟠 中 |

**小计**: ✅ 8 已支持 | 🟡 3 部分支持 | ❌ 15 未支持

### 类别 2: 系统监控类 (15-21, 29-31, 46) - 9个场景

| # | 场景 | 状态 | 现有支持 | 优先级 |
|---|------|------|----------|--------|
| 15 | 查看系统内存使用情况 | ✅ 已支持 | check_memory_usage | - |
| 16 | 查看CPU负载信息 | ✅ 已支持 | check_cpu_usage | - |
| 17 | 查看当前运行的进程 | ✅ 已支持 | list_processes | - |
| 18 | 终止指定进程 | ❌ 未支持 | - | 🔥 高 |
| 19 | 查看网络连接状态 | ✅ 已支持 | check_network_connections | - |
| 20 | 测试网络连通性 | ❌ 未支持 | - | 🔥 高 |
| 21 | 查看系统日志 | ✅ 已支持 | view_system_logs | - |
| 29 | 查看内核版本 | ✅ 已支持 | Shell (uname -r) | - |
| 30 | 查看系统运行时间 | ✅ 已支持 | check_uptime | - |
| 31 | 查看登录用户信息 | ✅ 已支持 | Shell (who, w) | - |
| 46 | 查看系统硬件信息 | 🟡 部分支持 | Shell (system_profiler, lshw) | 🟠 中 |

**小计**: ✅ 8 已支持 | 🟡 1 部分支持 | ❌ 2 未支持

### 类别 3: 软件管理类 (22-28) - 7个场景

| # | 场景 | 状态 | 现有支持 | 优先级 |
|---|------|------|----------|--------|
| 22 | 查看服务状态 | ❌ 未支持 | - | 🔥 高 |
| 23 | 启动/停止系统服务 | ❌ 未支持 | - | 🟠 中 |
| 24 | 安装软件包 | ❌ 未支持 | - | 🟠 中 |
| 25 | 更新软件包列表 | ❌ 未支持 | - | 🟢 低 |
| 26 | 升级已安装的软件包 | ❌ 未支持 | - | 🟢 低 |
| 27 | 卸载软件包 | ❌ 未支持 | - | 🟢 低 |
| 28 | 查看系统版本信息 | 🟡 部分支持 | Shell (sw_vers, lsb_release) | 🟢 低 |

**小计**: ✅ 0 已支持 | 🟡 1 部分支持 | ❌ 6 未支持

### 类别 4: 用户管理类 (32-34) - 3个场景

| # | 场景 | 状态 | 现有支持 | 优先级 |
|---|------|------|----------|--------|
| 32 | 切换用户身份 | ❌ 未支持 | - | 🟢 低 |
| 33 | 创建新用户账户 | ❌ 未支持 | - | 🟢 低 |
| 34 | 修改用户密码 | ❌ 未支持 | - | 🟢 低 |

**小计**: ✅ 0 已支持 | 🟡 0 部分支持 | ❌ 3 未支持

### 类别 5: 系统工具类 (44-45, 47-48) - 4个场景

| # | 场景 | 状态 | 现有支持 | 优先级 |
|---|------|------|----------|--------|
| 44 | 后台运行程序 | ❌ 未支持 | - | 🟠 中 |
| 45 | 定时执行任务 | ❌ 未支持 | - | 🟠 中 |
| 47 | 管理磁盘分区 | ❌ 未支持 | - | 🟢 低 |
| 48 | 挂载/卸载文件系统 | ❌ 未支持 | - | 🟢 低 |

**小计**: ✅ 0 已支持 | 🟡 0 部分支持 | ❌ 4 未支持

---

## 优先级分类

### 🔥 高优先级 (7个) - Phase 6.1

**文件管理核心**:
1. 创建目录 (mkdir)
2. 删除文件/目录 (rm, rmdir)
3. 复制文件 (cp)
4. 移动/重命名 (mv)

**系统监控核心**:
5. 终止进程 (kill)
6. 测试网络连通性 (ping)

**软件管理核心**:
7. 查看服务状态 (systemctl status, launchctl list)

**理由**: 这些是日常开发运维最频繁使用的命令，必须优先支持

### 🟠 中优先级 (12个) - Phase 6.2

**文件管理扩展**:
1. 查找文件增强 (find by name)
2. 修改文件权限 (chmod)
3. 压缩/解压缩 (tar, zip, gzip)
4. 比较文件差异 (diff)
5. 统计文件信息 (wc)
6. 备份/恢复

**系统监控扩展**:
7. 查看硬件信息 (system_profiler, lshw)

**软件管理**:
8. 启动/停止服务
9. 安装软件包

**系统工具**:
10. 后台运行程序 (nohup, &)
11. 定时任务 (cron)

### 🟢 低优先级 (11个) - Phase 6.3+

**高级系统操作** (需要 root 权限或特殊场景):
- 用户管理 (3个)
- 环境变量设置
- 符号链接
- 软件包更新/升级/卸载
- 磁盘分区管理
- 文件系统挂载
- 实时监控文件

---

## 实施计划

### Phase 6.1: 核心增强 (1-2周)

**目标**: 支持 7 个高优先级场景

#### 任务 1: 文件管理意图增强
```rust
// 新增 Intent
- create_directory    // 创建目录
- delete_file         // 删除文件/目录
- copy_file           // 复制文件
- move_file           // 移动/重命名文件
```

**关键词示例**:
- "创建一个名为 test 的目录"
- "删除 temp.txt 文件"
- "复制 src/main.rs 到 backup/"
- "移动 old.txt 到 archive/"

**Template 示例**:
```bash
mkdir -p {path}
rm -rf {path}
cp -r {source} {dest}
mv {source} {dest}
```

#### 任务 2: 系统监控意图增强
```rust
// 新增 Intent
- kill_process        // 终止进程
- ping_host           // 测试网络
```

**关键词示例**:
- "终止进程 1234"
- "杀掉 nginx 进程"
- "测试 google.com 的网络连通性"
- "ping baidu.com"

**Template 示例**:
```bash
kill -9 {pid}
pkill {name}
ping -c 4 {host}
```

#### 任务 3: 软件管理意图
```rust
// 新增 Intent
- check_service_status  // 查看服务状态
```

**关键词示例**:
- "查看 nginx 服务状态"
- "检查 mysql 是否运行"

**Template 示例**:
```bash
# macOS
launchctl list | grep {service}

# Linux
systemctl status {service}
```

**估计工作量**:
- Intent 定义: 3 小时
- Template 实现: 2 小时
- 测试: 2 小时
- 文档: 1 小时
**总计**: 8 小时 (1 天)

### Phase 6.2: 扩展增强 (2-3周)

**目标**: 支持 12 个中优先级场景

#### 任务 4: 文件查找增强
```rust
// 增强现有 Intent
- find_files_by_name   // 按名称查找
- find_files_by_type   // 按类型查找 (已有 find_recent_files 部分支持)
```

#### 任务 5: 文件权限和比较
```rust
// 新增 Intent
- change_permission    // 修改权限
- compare_files        // 比较文件
- count_file_stats     // 统计行数/字数 (增强现有 count_python_lines)
```

#### 任务 6: 压缩归档
```rust
// 新增 Intent
- compress_files       // 压缩文件
- extract_archive      // 解压缩
- backup_directory     // 备份目录
```

#### 任务 7: 软件和服务管理
```rust
// 新增 Intent
- manage_service       // 启动/停止服务
- install_package      // 安装软件包
- view_hardware_info   // 查看硬件信息
```

**估计工作量**: 15-20 小时 (2-3 天)

### Phase 6.3: 完整覆盖 (长期)

**目标**: 支持剩余 11 个低优先级场景

包括用户管理、高级系统工具等需要特殊权限的场景。

---

## 技术设计要点

### 安全考虑

1. **危险操作保护**:
   - `rm -rf`: 需要确认，避免误删
   - `kill -9`: 检查进程权限
   - 用户管理：需要 sudo 权限

2. **参数验证**:
   - 路径合法性检查
   - 进程 ID 有效性
   - 服务名称验证

3. **权限检查**:
   - 文件操作前检查权限
   - 系统命令需要提示权限要求

### 跨平台支持

**文件操作**: 基本统一
```rust
// macOS & Linux 通用
mkdir, rm, cp, mv, chmod
```

**系统监控**: 需要适配
```rust
// 服务管理
macOS: launchctl
Linux: systemctl

// 软件包管理
macOS: brew
Linux: apt-get / yum
```

**实现策略**:
```rust
fn get_service_command() -> &'static str {
    if cfg!(target_os = "macos") {
        "launchctl list | grep {service}"
    } else {
        "systemctl status {service}"
    }
}
```

### Intent 设计模式

**命名规范**:
- 动词+名词：`create_directory`, `delete_file`
- 一致性：所有文件操作都用 `file` 后缀

**实体提取**:
```rust
.with_entity("path", EntityType::Path)
.with_entity("source", EntityType::Path)
.with_entity("dest", EntityType::Path)
.with_entity("pid", EntityType::Number)
.with_entity("host", EntityType::String)
```

**置信度设置**:
- 高频操作：0.65+ (优先匹配)
- 一般操作：0.55
- 模糊操作：0.50

---

## 成功指标

### 量化目标

**Phase 6.1 完成后**:
- 场景覆盖率：36% → **50%+** (25个/50个)
- Intent 数量：16 → **23+**
- 用户满意度：核心操作可用

**Phase 6.2 完成后**:
- 场景覆盖率：50% → **75%+** (37个/50个)
- Intent 数量：23 → **30+**
- 用户满意度：大部分场景可用

**Phase 6.3 完成后**:
- 场景覆盖率：75% → **90%+** (45个/50个)
- Intent 数量：30 → **35+**
- 用户满意度：全场景覆盖

### 质量目标

- ✅ 所有新增 Intent 有单元测试
- ✅ 集成测试覆盖典型用户查询
- ✅ 文档完整（Intent DSL 指南更新）
- ✅ 跨平台验证（macOS + Linux）

---

## 风险和挑战

### 技术风险

1. **Shell 命令安全性** - 高
   - 缓解：参数严格验证，黑名单检查

2. **跨平台兼容性** - 中
   - 缓解：平台检测 + 条件编译

3. **权限问题** - 中
   - 缓解：清晰的错误提示，sudo 使用指导

### 工作量风险

1. **工作量估算偏低** - 中
   - 50个场景完整支持需要大量工作
   - 缓解：分阶段交付，优先级明确

2. **测试覆盖挑战** - 中
   - 系统级操作难以单元测试
   - 缓解：集成测试 + 手工验证

---

## 决策点

### 需要确认的问题

1. **是否立即开始 Phase 6.1？**
   - ✅ 建议：是，高优先级场景急需支持

2. **是否需要所有场景支持？**
   - 🟡 建议：优先 Phase 6.1 + 6.2，6.3 按需实施

3. **跨平台优先级？**
   - ✅ 建议：macOS 优先，Linux 并行验证

4. **安全机制是否足够？**
   - 🟡 建议：Phase 6.1 实施时加强确认机制

---

## 下一步行动

### 立即执行 (今天)

1. ✅ 完成本分析文档
2. 📝 获得用户/团队确认
3. 📝 开始 Phase 6.1 详细设计

### 本周执行

1. 📝 实现 Phase 6.1 的 7 个高优先级意图
2. 📝 编写测试
3. 📝 验证跨平台兼容性

### 下周执行

1. 📝 发布 Phase 6.1
2. 📝 收集用户反馈
3. 📝 规划 Phase 6.2

---

**文档版本**: v1.0
**创建日期**: 2025-10-15
**作者**: Claude Code
**状态**: 等待确认
