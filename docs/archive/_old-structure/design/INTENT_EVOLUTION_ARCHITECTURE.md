# Intent æ¼”åŒ–æ¶æ„è®¾è®¡ - ä»é™æ€æšä¸¾åˆ°åŠ¨æ€ç”Ÿæˆ

> **ä»"æœ€å¤§"åˆ°"æœ€å°"çœ‹ç³»ç»Ÿè®¾è®¡çš„æ ¹æœ¬é—®é¢˜**
> åˆ›å»ºæ—¥æœŸï¼š2025-10-15
> ç‰ˆæœ¬ï¼š1.0 - æ¶æ„æ€è€ƒ

---

## ğŸ¯ é—®é¢˜çš„æœ¬è´¨

### å…¸å‹æ¡ˆä¾‹å¯¹æ¯”

#### æ¡ˆä¾‹ Aï¼šæœ€å¤§æ–‡ä»¶ï¼ˆä¿®å¤åï¼‰âœ…

```
Â» æ˜¾ç¤ºå½“å‰ç›®å½•ä¸‹ä½“ç§¯æœ€å¤§çš„rsæ–‡ä»¶
âœ¨ Intent: find_large_files (ç½®ä¿¡åº¦: 1.00)
â†’ æ‰§è¡Œ: find . -name '*.rs' -type f -exec ls -lh {} + | sort -k5 -hr | head -n 1
ç»“æœï¼šâœ… æ­£ç¡®
```

#### æ¡ˆä¾‹ Bï¼šæœ€å°æ–‡ä»¶ï¼ˆä¿®å¤åï¼‰âŒ

```
Â» æ˜¾ç¤ºå½“å‰ç›®å½•ä¸‹ä½“ç§¯æœ€å°çš„rsæ–‡ä»¶
âœ¨ Intent: find_large_files (ç½®ä¿¡åº¦: 1.00)
â†’ æ‰§è¡Œ: find . -name '*.rs' -type f -exec ls -lh {} + | sort -k5 -hr | head -n 1
          â†‘ é—®é¢˜ï¼šä»ç„¶æ˜¯é™åº(-hr)ï¼Œåº”è¯¥æ˜¯å‡åº(-h)
ç»“æœï¼šâŒ æ˜¾ç¤ºæœ€å¤§çš„æ–‡ä»¶ï¼Œè€Œéæœ€å°çš„
```

### ä¸‰å±‚å¤±è´¥åˆ†æ

#### ç¬¬ä¸€å±‚å¤±è´¥ï¼šåˆšæ€§ä¿®æ­£æ— æ³•ç©·å°½

**å½“å‰åšæ³•**ï¼š
```rust
// ä¸ºæ¯ä¸ªå˜ä½“åˆ›å»ºæ–° Intent
find_large_files    // æœ€å¤§
find_small_files    // æœ€å° â† éœ€è¦æ–°å¢
find_oldest_files   // æœ€æ—§ â† éœ€è¦æ–°å¢
find_newest_files   // æœ€æ–° â† å·²æœ‰ find_recent_files
...                 // æ— ç©·æ— å°½
```

**é—®é¢˜**ï¼š
- âŒ **ç»„åˆçˆ†ç‚¸**ï¼šæ–‡ä»¶ç±»å‹ Ã— æ’åºå­—æ®µ Ã— æ’åºæ–¹å‘ Ã— æ˜¾ç¤ºæ•°é‡ = æ— ç©·å¤šç§
- âŒ **ç»´æŠ¤å›°éš¾**ï¼šæ¯å¢åŠ ä¸€ä¸ªå˜ä½“å°±è¦å†™ä¸€å¥—ä»£ç 
- âŒ **æ— æ³•æ³›åŒ–**ï¼šç”¨æˆ·è¯´"ä½“ç§¯ç¬¬äºŒå°"ã€"å€’æ•°ç¬¬ä¸‰å¤§"æ€ä¹ˆåŠï¼Ÿ

**è¿™æ˜¯ç¦»æ•£çš„ã€é™æ€çš„æ€ç»´ - å…¸å‹çš„è¥¿æ–¹äºŒåˆ†æ³•ï¼**

#### ç¬¬äºŒå±‚å¤±è´¥ï¼šLLM è¾…åŠ©æ— æ³•æ ¹æ²»

**å½“å‰æµç¨‹**ï¼š
```
Intent åŒ¹é… â†’ Template ç”Ÿæˆ â†’ LLM éªŒè¯ â†’ å‘ç°é”™è¯¯ â†’ è­¦å‘Šç”¨æˆ· â†’ ç”¨æˆ·æ”¾å¼ƒ
```

**é—®é¢˜**ï¼š
- âŒ **LLM åªèƒ½åæ€ï¼Œä¸èƒ½ä¿®æ­£**ï¼šå‘ç°äº†é—®é¢˜ï¼Œä½†ç”Ÿæˆä¸äº†æ­£ç¡®å‘½ä»¤
- âŒ **ç”¨æˆ·ä½“éªŒæå·®**ï¼šåå¤äº¤äº’ä¹Ÿå¾—ä¸åˆ°ç»“æœ
- âŒ **LLM æœªå‚ä¸æ„å›¾ç†è§£**ï¼šåªåœ¨æœ€åéªŒè¯ï¼Œå¤ªæ™šäº†

**LLM è¢«ç”¨ä½œ"äº‹åæ£€æŸ¥å™¨"ï¼Œè€Œé"æ ¸å¿ƒç†è§£å™¨"ï¼**

#### ç¬¬ä¸‰å±‚å¤±è´¥ï¼šæ¶æ„è®¾è®¡çš„å±€é™

**å½“å‰æ¶æ„**ï¼š
```
ç”¨æˆ·è¾“å…¥ â†’ Intent åŒ¹é… (é™æ€è§„åˆ™) â†’ Template é€‰æ‹© (1å¯¹1æ˜ å°„) â†’ å‘½ä»¤ç”Ÿæˆ
           â†“
       24ä¸ªé¢„å®šä¹‰ Intent (ç¦»æ•£çš„ã€ä¸å¯å˜çš„)
```

**é—®é¢˜**ï¼š
- âŒ **Intent æ˜¯é™æ€æšä¸¾**ï¼šæ— æ³•è¡¨è¾¾å˜åŒ–
- âŒ **Template æ˜¯å›ºå®šå­—ç¬¦ä¸²**ï¼šæ— æ³•æ ¹æ®å‚æ•°å˜åŒ–
- âŒ **æ˜ å°„æ˜¯ä¸€å¯¹ä¸€çš„**ï¼šä¸€ä¸ª Intent åªèƒ½å¯¹åº”ä¸€ä¸ªå›ºå®šæ¨¡æ¿

**è¿™æ˜¯"æ•°"çš„æ€ç»´ï¼ˆcountingï¼‰ï¼Œè€Œé"å˜"çš„æ€ç»´ï¼ˆtransformationï¼‰ï¼**

---

## ğŸŒŸ æ˜“ç»æ€æƒ³çš„æ·±åº¦å¯ç¤º

### é”™è¯¯çš„ç†è§£ï¼ˆæˆ‘ä¹‹å‰çš„ï¼‰

```
å¤ªæ â†’ é˜´é˜³ â†’ å››è±¡ â†’ å…«å¦ â†’ 64å¦ â†’ ...

ç†è§£ä¸ºï¼šä¸æ–­ç»†åˆ†ï¼Œæšä¸¾æ‰€æœ‰çŠ¶æ€
```

**è¿™ä»ç„¶æ˜¯é™æ€çš„ã€ç¦»æ•£çš„ï¼**

### æ­£ç¡®çš„ç†è§£ï¼ˆ"å˜"çš„æœ¬è´¨ï¼‰

```
é“ï¼ˆè§„å¾‹ï¼‰
  â†“
ä¸å˜çš„"è±¡"ï¼ˆåŸºç¡€æ“ä½œï¼‰
  â†“
å˜åŒ–çš„"çˆ»"ï¼ˆå‚æ•°/ç»´åº¦ï¼‰
  â†“
64å¦ = 8å¦çš„ç»„åˆä¸è½¬æ¢
  â†“
384çˆ» = å˜åŒ–çš„æ¼”åŒ–ç‚¹
```

**å…³é”®æ´å¯Ÿ**ï¼š
1. **è±¡æ˜¯ä¸å˜çš„**ï¼šæŸ¥æ‰¾æ–‡ä»¶ã€æ’åºã€è¿‡æ»¤ - è¿™äº›æ˜¯åŸºç¡€æ“ä½œ
2. **çˆ»æ˜¯å˜åŒ–çš„**ï¼šæ’åºæ–¹å‘ã€æ–‡ä»¶ç±»å‹ã€æ•°é‡ - è¿™äº›æ˜¯å‚æ•°
3. **å¦æ˜¯ç»„åˆçš„**ï¼šä¸åŒå‚æ•°çš„ç»„åˆäº§ç”Ÿä¸åŒçš„"å¦è±¡"
4. **å˜åŒ–æ˜¯è¿ç»­çš„**ï¼šä»"æœ€å¤§"åˆ°"æœ€å°"æ˜¯æ–¹å‘çš„åè½¬ï¼Œä¸æ˜¯æ–°çš„æ“ä½œ

### å¯¹åº”åˆ° RealConsole

#### å½“å‰é”™è¯¯çš„æ˜ å°„ï¼ˆç¦»æ•£ï¼‰

```rust
// âŒ æ¯ä¸ªå˜ä½“æ˜¯ä¸€ä¸ªç‹¬ç«‹çš„ Intent
enum Intent {
    FindLargeFiles,    // ä¹¾å¦ï¼Ÿ
    FindSmallFiles,    // å¤å¦ï¼Ÿ
    FindNewestFiles,   // éœ‡å¦ï¼Ÿ
    ...                // 64ä¸ªï¼Ÿ384ä¸ªï¼Ÿ
}
```

#### æ­£ç¡®çš„æ˜ å°„ï¼ˆç»„åˆï¼‰

```rust
// âœ… åŸºç¡€æ“ä½œï¼ˆè±¡ï¼‰+ å˜åŒ–ç»´åº¦ï¼ˆçˆ»ï¼‰
struct IntentExecution {
    base_operation: BaseOperation,  // ä¸å˜çš„"è±¡"
    parameters: Parameters,          // å˜åŒ–çš„"çˆ»"
}

enum BaseOperation {
    FindFiles,      // ä¹¾ï¼šæŸ¥æ‰¾
    ListFiles,      // å¤ï¼šåˆ—ä¸¾
    FilterFiles,    // å·½ï¼šè¿‡æ»¤
    SortFiles,      // å…‘ï¼šæ’åº
    ...
}

struct Parameters {
    sort_field: SortField,      // çˆ»1ï¼šæ’åºå­—æ®µï¼ˆsize/time/nameï¼‰
    sort_direction: Direction,   // çˆ»2ï¼šæ’åºæ–¹å‘ï¼ˆasc/descï¼‰
    file_type: String,          // çˆ»3ï¼šæ–‡ä»¶ç±»å‹ï¼ˆ*.rs/*ï¼‰
    limit: usize,               // çˆ»4ï¼šæ•°é‡é™åˆ¶ï¼ˆ1/10/allï¼‰
    ...
}

// 64å¦ = åŸºç¡€æ“ä½œçš„ç»„åˆ
// 384çˆ» = å‚æ•°çš„å˜åŒ–
```

### æ˜“ç»ä¸­çš„"å˜"ä¸"ä¸å˜"

**ä¸å˜ï¼ˆè±¡ï¼‰**ï¼š
- æŸ¥æ‰¾æ–‡ä»¶è¿™ä¸ª**æ“ä½œæœ¬èº«**
- æ’åºè¿™ä¸ª**æ“ä½œæœ¬èº«**
- è¿‡æ»¤è¿™ä¸ª**æ“ä½œæœ¬èº«**

**å˜åŒ–ï¼ˆçˆ»ï¼‰**ï¼š
- æ’åº**æ–¹å‘**ï¼šascending â‡„ descending
- æ’åº**å­—æ®µ**ï¼šsize â†’ time â†’ name
- æ–‡ä»¶**ç±»å‹**ï¼š*.rs â†’ *.py â†’ *
- æ˜¾ç¤º**æ•°é‡**ï¼š1 â†’ 10 â†’ all

**64å¦çš„æ™ºæ…§**ï¼š
```
å†…å¦ï¼ˆåŸºç¡€æ“ä½œï¼‰ Ã— å¤–å¦ï¼ˆä½œç”¨å¯¹è±¡ï¼‰ = å…·ä½“æ„å›¾

ä¾‹å¦‚ï¼š
find_files Ã— sort(size, desc) = æŸ¥æ‰¾æœ€å¤§æ–‡ä»¶
find_files Ã— sort(size, asc)  = æŸ¥æ‰¾æœ€å°æ–‡ä»¶
find_files Ã— sort(time, desc) = æŸ¥æ‰¾æœ€æ–°æ–‡ä»¶
```

**384çˆ»çš„æ™ºæ…§**ï¼š
- æ¯ä¸€çˆ»ä»£è¡¨ä¸€ä¸ªå¯ä»¥å˜åŒ–çš„"æ¼”åŒ–ç‚¹"
- ä¸éœ€è¦æšä¸¾æ‰€æœ‰çŠ¶æ€ï¼Œåªéœ€è¦çŸ¥é“å˜åŒ–çš„**è§„å¾‹**

---

## ğŸ”§ æ ¹æœ¬è§£å†³æ–¹æ¡ˆï¼šä¸‰å±‚é€’è¿›

### æ–¹æ¡ˆ 1ï¼šå‚æ•°åŒ–æ¨¡æ¿ï¼ˆçŸ­æœŸ - ç«‹å³å®æ–½ï¼‰

**æ ¸å¿ƒæ€æƒ³**ï¼šä¸€ä¸ª Intentï¼Œå¤šç§å‚æ•°ç»„åˆ

#### ç°çŠ¶é—®é¢˜

```rust
// âŒ å½“å‰ï¼šå›ºå®šæ¨¡æ¿
Template {
    name: "find_large_files",
    command: "find {path} -name '*.{ext}' -type f -exec ls -lh {} + | sort -k5 -hr | head -n {limit}",
                                                                               â†‘â†‘
                                                                          å›ºå®šæ˜¯é™åºï¼
}
```

#### æ”¹è¿›æ–¹æ¡ˆ

```rust
// âœ… æ”¹è¿›ï¼šå‚æ•°åŒ–æ’åºæ–¹å‘
Template {
    name: "find_files_by_size",
    command: "find {path} -name '*.{ext}' -type f -exec ls -lh {} + | sort -k5 {sort_order} | head -n {limit}",
                                                                               â†‘â†‘â†‘â†‘â†‘â†‘â†‘â†‘â†‘â†‘â†‘
                                                                          å‚æ•°åŒ–çš„æ’åºæ–¹å‘ï¼
    parameters: ["path", "ext", "sort_order", "limit"],
}

// å‚æ•°æ˜ å°„
"æœ€å¤§" â†’ sort_order = "-hr"  (é™åº)
"æœ€å°" â†’ sort_order = "-h"   (å‡åº)
```

#### å®ä½“æå–å¢å¼º

```rust
// æ–°å¢å®ä½“ç±»å‹ï¼šSortDirection
enum EntityType {
    FileType(String),
    Path(String),
    Number(f64),
    SortDirection(Direction),  // æ–°å¢ï¼
    SortField(Field),           // æ–°å¢ï¼
}

enum Direction {
    Ascending,   // å‡åºï¼š-h
    Descending,  // é™åºï¼š-hr
}

enum Field {
    Size,   // å¤§å°
    Time,   // æ—¶é—´
    Name,   // åç§°
}
```

#### å®ä½“æå–è§„åˆ™

```rust
// ä»ç”¨æˆ·è¾“å…¥æå–æ’åºæ–¹å‘
fn extract_sort_direction(input: &str) -> Direction {
    if input.contains("æœ€å¤§") || input.contains("å¤§äº") || input.contains("largest") {
        Direction::Descending
    } else if input.contains("æœ€å°") || input.contains("å°äº") || input.contains("smallest") {
        Direction::Ascending
    } else {
        Direction::Descending  // é»˜è®¤é™åº
    }
}
```

**ä¼˜ç‚¹**ï¼š
- âœ… ç«‹å³è§£å†³"æœ€å°"çš„é—®é¢˜
- âœ… æ‰©å±•æ€§å¥½ï¼šå¯ä»¥ç»§ç»­æ·»åŠ å…¶ä»–å‚æ•°
- âœ… å…¼å®¹ç°æœ‰æ¶æ„ï¼šåªéœ€è¦å¢å¼ºå®ä½“æå–

**ç¼ºç‚¹**ï¼š
- âš ï¸ ä»ç„¶æ˜¯é¢„å®šä¹‰çš„æ¨¡æ¿
- âš ï¸ å¤æ‚æŸ¥è¯¢ä»ç„¶éœ€è¦æ–°æ¨¡æ¿

**æ˜“ç»å¯¹åº”**ï¼š
- è±¡ï¼ˆåŸºç¡€æ“ä½œï¼‰ï¼š`find_files_by_size`
- çˆ»ï¼ˆå˜åŒ–ç»´åº¦ï¼‰ï¼š`sort_order` å‚æ•°
- è¿™æ˜¯è¯†åˆ«äº†"å˜åŒ–ç‚¹"ï¼Œä½†ä»æ˜¯å›ºå®šçš„æ¨¡æ¿

---

### æ–¹æ¡ˆ 2ï¼šç»„åˆå¼ Intentï¼ˆä¸­æœŸ - Phase 6.3ï¼‰

**æ ¸å¿ƒæ€æƒ³**ï¼šIntent ä¸æ˜¯ç»ˆç‚¹ï¼Œè€Œæ˜¯å¯ç»„åˆçš„ç®¡é“

#### Pipeline DSL æ¶æ„

```rust
// åŸºç¡€æ“ä½œï¼ˆè±¡ï¼‰
enum BaseOperation {
    FindFiles(path: String, pattern: String),
    ListFiles(path: String),
    FilterFiles(condition: Condition),
    SortFiles(field: Field, direction: Direction),
    LimitFiles(n: usize),
}

// æ‰§è¡Œè®¡åˆ’ = æ“ä½œçš„ç»„åˆ
struct ExecutionPlan {
    operations: Vec<BaseOperation>,
}

// ç¤ºä¾‹ï¼šæŸ¥æ‰¾æœ€å°çš„ rs æ–‡ä»¶
let plan = ExecutionPlan {
    operations: vec![
        FindFiles(".", "*.rs"),
        SortFiles(Field::Size, Direction::Ascending),
        LimitFiles(1),
    ]
};

// ç”Ÿæˆ Shell å‘½ä»¤
plan.to_shell_command()
    â†’ "find . -name '*.rs' -type f -exec ls -lh {} + | sort -k5 -h | head -n 1"
```

#### Intent ç»„åˆè§„åˆ™

```rust
// Intent åŒ¹é…è¿”å›åŸºç¡€æ“ä½œ
fn match_base_operation(input: &str) -> BaseOperation {
    if contains_keywords(input, &["æŸ¥æ‰¾", "æ˜¾ç¤º", "æ–‡ä»¶"]) {
        return FindFiles(extract_path(input), extract_pattern(input));
    }
    // ...
}

// å‚æ•°åŒ¹é…è¿”å›ä¿®é¥°æ“ä½œ
fn match_modifiers(input: &str) -> Vec<BaseOperation> {
    let mut modifiers = Vec::new();

    if contains_keywords(input, &["æœ€å¤§", "æœ€å°", "æ’åº"]) {
        let direction = extract_sort_direction(input);
        let field = extract_sort_field(input);
        modifiers.push(SortFiles(field, direction));
    }

    if contains_keywords(input, &["ç¬¬ä¸€", "å‰", "top"]) {
        let n = extract_number(input);
        modifiers.push(LimitFiles(n));
    }

    modifiers
}

// ç»„åˆæˆå®Œæ•´è®¡åˆ’
fn build_execution_plan(input: &str) -> ExecutionPlan {
    let base = match_base_operation(input);
    let modifiers = match_modifiers(input);

    ExecutionPlan {
        operations: [vec![base], modifiers].concat()
    }
}
```

**ä¼˜ç‚¹**ï¼š
- âœ… çœŸæ­£çš„ç»„åˆæ€§ï¼šæ— é™æ‰©å±•
- âœ… ç¬¦åˆ Unix å“²å­¦ï¼šç®¡é“æ€ç»´
- âœ… æ˜“äºç†è§£å’Œè°ƒè¯•

**ç¼ºç‚¹**ï¼š
- âš ï¸ éœ€è¦é‡æ„ç°æœ‰æ¶æ„
- âš ï¸ ä»éœ€é¢„å®šä¹‰åŸºç¡€æ“ä½œ

**æ˜“ç»å¯¹åº”**ï¼š
- è±¡ï¼ˆåŸºç¡€æ“ä½œï¼‰ï¼šFindFiles, SortFiles, LimitFiles
- çˆ»ï¼ˆå‚æ•°ï¼‰ï¼šæ¯ä¸ªæ“ä½œçš„å‚æ•°
- å¦ï¼ˆç»„åˆï¼‰ï¼šæ“ä½œçš„ç»„åˆ = æ‰§è¡Œè®¡åˆ’
- **è¿™æ˜¯çœŸæ­£çš„"ç»„åˆä¸å˜åŒ–"ï¼**

---

### æ–¹æ¡ˆ 3ï¼šLLM é©±åŠ¨çš„åŠ¨æ€ç”Ÿæˆï¼ˆé•¿æœŸ - Phase 7ï¼‰

**æ ¸å¿ƒæ€æƒ³**ï¼šLLM å‚ä¸æ„å›¾ç†è§£ï¼Œç”Ÿæˆç»“æ„åŒ–æ‰§è¡Œè®¡åˆ’

#### æ–°æ¶æ„æµç¨‹

```
ç”¨æˆ·è¾“å…¥
  â†“
LLM ç†è§£ï¼ˆç”Ÿæˆç»“æ„åŒ–æ„å›¾ï¼‰
  â†“
ç»“æ„åŒ–æ‰§è¡Œè®¡åˆ’ï¼ˆJSONï¼‰
  â†“
å®‰å…¨éªŒè¯
  â†“
Shell å‘½ä»¤ç”Ÿæˆ
  â†“
æ‰§è¡Œ
```

#### LLM Prompt è®¾è®¡

```
ä½ æ˜¯ä¸€ä¸ªæ–‡ä»¶æ“ä½œæ„å›¾ç†è§£åŠ©æ‰‹ã€‚å°†ç”¨æˆ·çš„è‡ªç„¶è¯­è¨€è½¬æ¢ä¸ºç»“æ„åŒ–çš„æ‰§è¡Œè®¡åˆ’ã€‚

è¾“å‡ºæ ¼å¼ï¼ˆJSONï¼‰ï¼š
{
  "operation": "find_files",
  "parameters": {
    "path": ".",
    "pattern": "*.rs"
  },
  "modifiers": [
    {
      "operation": "sort",
      "field": "size",
      "direction": "ascending"
    },
    {
      "operation": "limit",
      "count": 1
    }
  ]
}

ç”¨æˆ·è¾“å…¥ï¼šæ˜¾ç¤ºå½“å‰ç›®å½•ä¸‹ä½“ç§¯æœ€å°çš„rsæ–‡ä»¶

ä½ çš„è¾“å‡ºï¼š
```

#### LLM è¾“å‡ºç¤ºä¾‹

```json
{
  "operation": "find_files",
  "parameters": {
    "path": ".",
    "pattern": "*.rs"
  },
  "modifiers": [
    {
      "operation": "sort",
      "field": "size",
      "direction": "ascending"  // â† LLM ç†è§£äº†"æœ€å°"
    },
    {
      "operation": "limit",
      "count": 1
    }
  ],
  "explanation": "æŸ¥æ‰¾å½“å‰ç›®å½•ä¸‹æ‰€æœ‰.rsæ–‡ä»¶ï¼ŒæŒ‰å¤§å°å‡åºæ’åˆ—ï¼Œæ˜¾ç¤ºæœ€å°çš„é‚£ä¸ª"
}
```

#### ä»£ç å®ç°

```rust
// 1. LLM ç”Ÿæˆç»“æ„åŒ–æ„å›¾
async fn understand_intent_with_llm(input: &str) -> Result<StructuredIntent> {
    let prompt = format!("{}\nç”¨æˆ·è¾“å…¥ï¼š{}", INTENT_PROMPT, input);
    let response = llm_client.chat(&prompt).await?;

    // è§£æ JSON
    let intent: StructuredIntent = serde_json::from_str(&response)?;
    Ok(intent)
}

// 2. è½¬æ¢ä¸ºæ‰§è¡Œè®¡åˆ’
fn to_execution_plan(intent: StructuredIntent) -> ExecutionPlan {
    let mut operations = vec![
        BaseOperation::from_json(intent.operation, intent.parameters)
    ];

    for modifier in intent.modifiers {
        operations.push(BaseOperation::from_json(modifier.operation, modifier.parameters));
    }

    ExecutionPlan { operations }
}

// 3. ç”Ÿæˆ Shell å‘½ä»¤
impl ExecutionPlan {
    fn to_shell_command(&self) -> String {
        // find . -name '*.rs' -type f -exec ls -lh {} + | sort -k5 -h | head -n 1
        let mut cmd = String::new();

        for op in &self.operations {
            match op {
                BaseOperation::FindFiles(path, pattern) => {
                    cmd.push_str(&format!("find {} -name '{}' -type f -exec ls -lh {{}} + ", path, pattern));
                }
                BaseOperation::SortFiles(field, direction) => {
                    let sort_key = match field {
                        Field::Size => "5",
                        Field::Time => "6",
                        Field::Name => "9",
                    };
                    let sort_opt = match direction {
                        Direction::Ascending => "-h",
                        Direction::Descending => "-hr",
                    };
                    cmd.push_str(&format!("| sort -k{} {} ", sort_key, sort_opt));
                }
                BaseOperation::LimitFiles(n) => {
                    cmd.push_str(&format!("| head -n {} ", n));
                }
                _ => {}
            }
        }

        cmd.trim().to_string()
    }
}
```

**ä¼˜ç‚¹**ï¼š
- âœ… çœŸæ­£çš„è‡ªç„¶è¯­è¨€ç†è§£ï¼šLLM çš„ä¼˜åŠ¿
- âœ… æ— éœ€é¢„å®šä¹‰æ‰€æœ‰å˜ä½“
- âœ… å¯ä»¥å¤„ç†å¤æ‚æŸ¥è¯¢ï¼š"å€’æ•°ç¬¬ä¸‰å¤§"ã€"ä½“ç§¯åœ¨100KB-1MBä¹‹é—´"

**ç¼ºç‚¹**ï¼š
- âš ï¸ ä¾èµ– LLM è´¨é‡
- âš ï¸ éœ€è¦ç»“æ„åŒ–è¾“å‡ºéªŒè¯
- âš ï¸ æ€§èƒ½å’Œæˆæœ¬

**æ˜“ç»å¯¹åº”**ï¼š
- é“ï¼ˆè§„å¾‹ï¼‰ï¼šLLM å­¦ä¹ åˆ°çš„æ„å›¾ç†è§£è§„å¾‹
- è±¡ï¼ˆåŸºç¡€æ“ä½œï¼‰ï¼šç»“æ„åŒ– JSON ä¸­çš„ operation
- çˆ»ï¼ˆå‚æ•°ï¼‰ï¼šç»“æ„åŒ– JSON ä¸­çš„ parameters
- å˜åŒ–ï¼šLLM å¯ä»¥ç†è§£æ— ç©·å¤šçš„å˜ä½“
- **è¿™æ˜¯"è§„å¾‹å­¦ä¹ "çš„æœ€é«˜å±‚æ¬¡ï¼**

---

## ğŸ¯ æ¨èå®æ–½è·¯å¾„

### Phase 6.2.1ï¼šå‚æ•°åŒ–æ¨¡æ¿ï¼ˆæœ¬å‘¨ï¼‰

**ç›®æ ‡**ï¼šç«‹å³è§£å†³"æœ€å°"é—®é¢˜

**ä»»åŠ¡**ï¼š
1. âœ… é‡å‘½å `find_large_files` â†’ `find_files_by_size`ï¼ˆæ›´é€šç”¨ï¼‰
2. âœ… æ·»åŠ  `sort_order` å‚æ•°åˆ°æ¨¡æ¿
3. âœ… å¢å¼ºå®ä½“æå–ï¼šè¯†åˆ«"æœ€å¤§/æœ€å°"
4. âœ… æµ‹è¯•éªŒè¯

**ä»£ç æ”¹åŠ¨é‡**ï¼š~100 è¡Œ

**äº¤ä»˜ç‰©**ï¼š
- `find_files_by_size` Intentï¼ˆæ”¯æŒæœ€å¤§/æœ€å°ï¼‰
- 5 ä¸ªæµ‹è¯•ç”¨ä¾‹
- ä¿®å¤æŠ¥å‘Š

### Phase 6.3ï¼šPipeline DSLï¼ˆä¸‹æœˆï¼‰

**ç›®æ ‡**ï¼šå»ºç«‹ç»„åˆå¼æ¶æ„

**ä»»åŠ¡**ï¼š
1. è®¾è®¡ `BaseOperation` æšä¸¾
2. å®ç° `ExecutionPlan` ç»“æ„
3. é‡æ„ Intent åŒ¹é…ï¼šè¿”å›æ“ä½œç»„åˆ
4. å®ç° `to_shell_command()` ç”Ÿæˆå™¨
5. è¿ç§»ç°æœ‰ Intent åˆ°æ–°æ¶æ„

**ä»£ç æ”¹åŠ¨é‡**ï¼š~1000 è¡Œ

**äº¤ä»˜ç‰©**ï¼š
- Pipeline DSL æ¶æ„æ–‡æ¡£
- æ ¸å¿ƒä»£ç å®ç°
- è¿ç§»æŒ‡å—

### Phase 7ï¼šLLM é©±åŠ¨ï¼ˆä¸‹å­£åº¦ï¼‰

**ç›®æ ‡**ï¼šçœŸæ­£çš„æ™ºèƒ½æ„å›¾ç†è§£

**ä»»åŠ¡**ï¼š
1. è®¾è®¡ LLM Prompt
2. å®ç°ç»“æ„åŒ–è¾“å‡ºè§£æ
3. å®‰å…¨éªŒè¯æœºåˆ¶
4. æ€§èƒ½ä¼˜åŒ–ï¼ˆç¼“å­˜ã€æ‰¹å¤„ç†ï¼‰
5. A/B æµ‹è¯•

**ä»£ç æ”¹åŠ¨é‡**ï¼š~500 è¡Œ

**äº¤ä»˜ç‰©**ï¼š
- LLM é©±åŠ¨çš„æ„å›¾ç†è§£ç³»ç»Ÿ
- æ€§èƒ½æµ‹è¯•æŠ¥å‘Š
- ç”¨æˆ·ä½“éªŒå¯¹æ¯”

---

## ğŸ’¡ æ ¸å¿ƒæ´å¯Ÿ

### 1. ä»"æ•°"åˆ°"å˜"çš„è½¬å˜

**é”™è¯¯æ€ç»´**ï¼š
```
çŠ¶æ€1, çŠ¶æ€2, çŠ¶æ€3, ... çŠ¶æ€N  (æ•°)
```

**æ­£ç¡®æ€ç»´**ï¼š
```
åŸºç¡€çŠ¶æ€ Ã— å˜åŒ–ç»´åº¦ = æ— ç©·çŠ¶æ€  (å˜)
```

### 2. ä»"æšä¸¾"åˆ°"ç”Ÿæˆ"çš„è½¬å˜

**é”™è¯¯æ€ç»´**ï¼š
```
ç©·ä¸¾æ‰€æœ‰å¯èƒ½çš„ Intent
```

**æ­£ç¡®æ€ç»´**ï¼š
```
å®šä¹‰åŸºç¡€æ“ä½œ + å˜åŒ–è§„å¾‹ â†’ åŠ¨æ€ç”Ÿæˆæ‰§è¡Œè®¡åˆ’
```

### 3. ä»"ç¦»æ•£"åˆ°"è¿ç»­"çš„è½¬å˜

**é”™è¯¯æ€ç»´**ï¼š
```
æœ€å¤§ â‰  æœ€å°  (ä¸¤ä¸ªç‹¬ç«‹çš„ä¸œè¥¿)
```

**æ­£ç¡®æ€ç»´**ï¼š
```
æœ€å¤§ â‡„ æœ€å°  (åŒä¸€ç»´åº¦çš„ä¸¤ç«¯ï¼Œå¯ä»¥è¿ç»­å˜åŒ–)
```

### 4. æ˜“ç»çš„æœ¬è´¨ä¸æ˜¯"æ•°"ï¼Œè€Œæ˜¯"å˜"

**64å¦**ä¸æ˜¯ 64 ä¸ªç¦»æ•£çŠ¶æ€ï¼Œè€Œæ˜¯ï¼š
- 8 ä¸ªåŸºç¡€ç‰¹å¾ï¼ˆå…«å¦ï¼‰çš„ç»„åˆ
- 6 ä¸ªæ¼”åŒ–ç‚¹ï¼ˆå…­çˆ»ï¼‰çš„å˜åŒ–
- æ— ç©·å˜åŒ–çš„è§„å¾‹æ€»ç»“

**å¯¹åº” RealConsole**ï¼š
- ä¸æ˜¯å®šä¹‰ 64 ä¸ª Intent
- è€Œæ˜¯å®šä¹‰ 8 ä¸ªåŸºç¡€æ“ä½œ + å‚æ•°å˜åŒ–è§„å¾‹
- åŠ¨æ€ç”Ÿæˆæ‰§è¡Œè®¡åˆ’

---

## ğŸ“š å‚è€ƒæ–‡çŒ®

- **æ˜“ç»**ï¼šå…«å¦ã€64å¦ã€384çˆ»çš„å˜åŒ–æ™ºæ…§
- **é“å¾·ç»ç¬¬äºŒåäºŒç« **ï¼š"å°‘åˆ™å¾—ï¼Œå¤šåˆ™æƒ‘"
- **Unix å“²å­¦**ï¼šPipeline æ€ç»´ï¼Œç»„åˆä¼˜äºæšä¸¾
- **å‡½æ•°å¼ç¼–ç¨‹**ï¼šç»„åˆå­ï¼ˆCombinatorï¼‰æ¨¡å¼

---

**æ–‡æ¡£ç‰ˆæœ¬**: 1.0
**åˆ›å»ºæ—¥æœŸ**: 2025-10-15
**ç»´æŠ¤è€…**: RealConsole Team

**æ ¸å¿ƒç†å¿µ**ï¼š
> Intent ä¸æ˜¯é™æ€çš„æšä¸¾ï¼Œè€Œæ˜¯åŠ¨æ€çš„ç”Ÿæˆã€‚
> ä¸æ˜¯"æ•°"ï¼ˆcountingï¼‰çš„æ€ç»´ï¼Œè€Œæ˜¯"å˜"ï¼ˆtransformationï¼‰çš„æ€ç»´ã€‚
> ç³»ç»Ÿåº”è¯¥èƒ½ç†è§£å˜åŒ–çš„è§„å¾‹ï¼Œè€Œéç©·ä¸¾æ‰€æœ‰çŠ¶æ€ã€‚âœ¨
